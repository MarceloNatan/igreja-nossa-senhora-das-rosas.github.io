---
layout: default
title: Detalhe do Artigo
---

<div class="container my-5">
    <div class="row">
        <div class="col-lg-10 offset-lg-1">
            <div id="artigo-detalhe-conteudo">
                <p class="text-center">Carregando artigo...</p>
            </div>
        </div>
    </div>
</div>

<script>
    // SCRIPT FINAL DE BUSCA E EXIBIÇÃO DO ARTIGO

    // 1. Obtém o slug da URL
    const urlParams = new URLSearchParams(window.location.search);
    const slug = urlParams.get('slug');
    
    // URL REST API com filtro de slug e populate (para obter todos os dados)
    const apiURL = `https://cms.igrejanossasenhoradasrosas.com.br/api/artigos?filters[slug][$eq]=${slug}&populate=*`;
    
    if (slug) {
        fetch(apiURL)
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('artigo-detalhe-conteudo');
                
                if (data.data && data.data.length > 0) {
                    const item = data.data[0];
                    
                    // CORREÇÃO CRÍTICA: Assume a estrutura plana que o JSON da API envia
                    // O seu JSON não tem o 'attributes' aninhado, então usamos 'item' diretamente
                    const content = item.attributes ? item.attributes : item; 

                    const titulo = content.Titulo || 'Título Não Encontrado';
                    const dataDeUso = content.data_publicacao || content.createdAt || new Date(); 
                    const dataFormatada = new Date(dataDeUso).toLocaleDateString('pt-BR');
                    
                    // CORREÇÃO FINAL DE EXIBIÇÃO DO CONTEÚDO (Lendo apenas o texto simples)
                    const corpoTextoSimples = content.conteudo && 
                                              content.conteudo[0] && 
                                              content.conteudo[0].children[0] ? 
                                              content.conteudo[0].children[0].text : 
                                              'Corpo do Artigo não pode ser formatado. Utilize texto simples no CMS.';
                    
                    // Estrutura HTML do artigo completo
                    container.innerHTML = `
                        <h1 class="display-4 mb-4">${titulo}</h1>
                        <p class="text-muted mb-5">Publicado em: ${dataFormatada}</p>
                        
                        <div class="artigo-corpo">
                            <p>${corpoTextoSimples}</p>
                        </div>
                        
                        <a href="/" class="btn btn-outline-primary mt-5">← Voltar para a Home</a>
                    `;
                } else {
                    container.innerHTML = '<h1 class="text-center">Artigo não encontrado.</h1>';
                }
            })
            .catch(error => {
                console.error("Erro ao buscar artigo:", error);
                document.getElementById('artigo-detalhe-conteudo').innerHTML = '<h1 class="text-danger text-center">Falha ao carregar o artigo.</h1>';
            });
    } else {
        document.getElementById('artigo-detalhe-conteudo').innerHTML = '<h1 class="text-center">Slug não fornecido.</h1>';
    }
</script>